{"version":3,"sources":["assets\\src\\scenes\\room\\message\\MessagePanel.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { G } from \"../../../G\";\nimport { BulletMessage } from \"./BulletMessage\";\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport class MessagePanel extends cc.Component {\n    @property(cc.Label)\n    private messageLabel: cc.Label = null;\n    @property(cc.Button)\n    private sendButton: cc.Button = null;\n    @property(cc.EditBox)\n    private inputBox: cc.EditBox = null;\n    @property(cc.Button)\n    private switchButton: cc.Button = null;\n    @property(cc.Node)\n    private content: cc.Node = null;\n    @property(cc.Node)\n    private bulletContainer: cc.Node = null;\n    @property(cc.Prefab)\n    private bulletMessagePrefab: cc.Prefab = null;\n\n    private isOpen = false;\n\n    protected onLoad() {\n        this.addListeners();\n    }\n\n    public show() {\n        this.switchButton.node.active = true;\n    }\n\n    public hide() {\n        this.switchButton.node.active = false;\n        this.close();\n    }\n\n    public switch() {\n        this.isOpen?this.close():this.open();\n    }\n    \n    public open() {\n        this.switchButton.getComponent(cc.Animation).play(\"message_open\");\n        this.isOpen = true;\n    }\n\n    public close() {\n        this.switchButton.getComponent(cc.Animation).play(\"message_close\");\n        this.isOpen = false;\n    }\n\n    private onBtnSend() {\n        if (G.ws.isOpen) {\n            let inputStr = this.inputBox.string;\n            G.ws.emit(\"message\", inputStr);\n            this.inputBox.string = \"\";\n        } else {\n            this.pushMessage(\"ws没有连接...\");\n        }\n    }\n\n    private onWsMessage(data) {\n        this.pushMessage(data);\n    }\n\n    public pushMessage(newMessage: string) {\n        this.messageLabel.string += '\\n' + newMessage;\n        this.pushBulletMessage(newMessage);\n    }\n\n    public pushBulletMessage(message: string) {\n        let bulletNode = cc.instantiate(this.bulletMessagePrefab);\n        let bulletMessage: BulletMessage = bulletNode.getComponent(BulletMessage);\n        bulletMessage.show(message);\n        this.bulletContainer.addChild(bulletNode);\n        let h = this.bulletContainer.height*Math.random();\n        bulletNode.x = cc.director.getWinSize().width/2 + 200;\n        bulletNode.y = -this.bulletContainer.height/2+h;\n        bulletNode.runAction(cc.moveTo(6,cc.p(-cc.director.getWinSize().width,bulletNode.y)));\n    }\n\n    private addListeners() {\n        G.ws.on(\"message\", this.onWsMessage, this);\n    }\n\n}"]}