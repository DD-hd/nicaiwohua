{"version":3,"sources":["assets\\src\\scenes\\room\\RoomScene.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { G } from \"../../G\";\nimport { Desk } from \"./desk/Desk\";\nimport { Sketchpad } from \"../share/Sketchpad\";\nimport { TopBar } from \"./topbar/TopBar\";\nimport { PreparePanel } from \"./prepare/PreparePanel\";\nimport { MessagePanel } from \"./message/MessagePanel\";\nimport { ToolPanel } from \"./tool/ToolPanel\";\nimport { SketchpadEvent } from \"../../events/SketchpadEvent\";\nimport { OverPanel } from \"./over/OverPanel\";\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class RoomScene extends cc.Component {\n\n    @property(TopBar)\n    private topBar: TopBar = null;\n    @property(PreparePanel)\n    private preparePanel: PreparePanel = null;\n    @property(cc.Node)\n    private board: cc.Node = null;\n    @property(Desk)\n    private desk: Desk = null;\n    @property(MessagePanel)\n    private messagePanel = null;\n    @property(ToolPanel)\n    private toolPanel: ToolPanel = null;\n    @property(OverPanel)\n    private overPanel: OverPanel = null;\n    @property(cc.Prefab)\n    private sketchpadPrefab: cc.Prefab = null;\n\n    private sketchpad: Sketchpad = null;\n\n    private intervalId: number;\n\n    start() {\n        this.topBar.showMessage(\"房间号：\" + G.room.getRid());\n        let sketchpadNode = cc.instantiate(this.sketchpadPrefab);\n        this.board.addChild(sketchpadNode);\n        this.sketchpad = sketchpadNode.getComponent(Sketchpad);\n        this.preparePanel.show();\n        this.messagePanel.show();\n        this.toolPanel.hide();\n        this.overPanel.hide();\n        this.addListeners();\n\n    }\n\n    // 同步绘画信息\n    syncPath() {\n        if (this.sketchpad.isDrawing && this.sketchpad.path.length > 0) {\n            let path = this.sketchpad.popPath();\n            G.ws.emit(\"draw\", {\n                type: \"path\",\n                path: path,\n            });\n        }\n    }\n\n    onGameStart() {\n        this.desk.show();\n        this.desk.updateSeatsInfo(G.room.getSeatMap());\n    }\n\n    onWsStartMe(data) {\n        if (data.gameNum === 1) {\n            this.onGameStart();\n        }\n        this.sketchpad.clear();\n        this.desk.hideAnswerButton();\n        this.topBar.showMessage(`你画:${data.word}`);\n        this.topBar.showTicker(G.room.getGameTime());\n        this.sketchpad.enableDraw();\n        this.toolPanel.show();\n        this.messagePanel.hide();\n        this.desk.hideAllTip();\n    }\n\n    onWsStartOther(data) {\n        if (data.gameNum === 1) {\n            this.onGameStart();\n        }\n        this.sketchpad.clear();\n        this.desk.showAnswerButton();\n        this.topBar.showMessage(`提示:${data.hint}`);\n        this.topBar.showTicker(G.room.getGameTime());\n        this.sketchpad.disableDraw();\n        this.toolPanel.hide();\n        this.messagePanel.show();\n        this.desk.hideAllTip();\n    }\n\n    onWsDraw(data) {\n        if (data.type === \"path\") {\n            this.sketchpad.drawByPath(data.path);\n        } else if (data.type === \"color\") {\n            this.sketchpad.setPenColor(data.color);\n        } else if (data.type === \"width\") {\n            this.sketchpad.setLineWidth(data.width);\n        } else if (data.type === \"clear\") {\n            this.sketchpad.clear();\n        }\n    }\n\n    onWsAnswer(data) {\n        if (data.isRight) {\n            for (let i in data.scores) {\n                G.room.setScoreBySeat(+i, data.scores[i]);\n                if (G.room.getUidBySeat(+i) === G.user.getUid()) {\n                    this.desk.hideAnswerButton();\n                }\n                if(+i !== G.room.getPaintSeat() ){\n                    this.desk.answerRight(+i,data.scores[i]);\n                }\n            }\n            this.desk.updateSeatsInfo(G.room.getSeatMap());\n        } else {\n            this.desk.answerWrong(data.seat);\n        }\n    }\n\n    onWsResult(data) {\n        this.desk.hideAnswerButton();\n        this.topBar.showMessage(\"答案:\" + data);\n        this.topBar.showTicker(G.room.getResultTime());\n        this.sketchpad.disableDraw();\n        this.messagePanel.show();\n        this.toolPanel.hide();\n    }\n\n    onWsOver(data) {\n        this.desk.hideAnswerButton();\n        this.overPanel.show();\n        this.topBar.showMessage(\"游戏结束，赶紧走吧\");\n        setTimeout(() => {\n            G.onExitRoom();\n        }, 10000);\n    }\n\n    onWsExit(data) {\n        this.desk.leaveUser(data);\n    }\n\n    onSketchpadColor(event: SketchpadEvent) {\n        this.sketchpad.setPenColor(event.hexColor);\n        G.ws.emit(\"draw\", {\n            type: \"color\",\n            color: event.hexColor,\n        });\n    }\n\n    onSketchpadWidth(event: SketchpadEvent) {\n        this.sketchpad.setLineWidth(event.width);\n        G.ws.emit(\"draw\", {\n            type: \"width\",\n            width: event.width,\n        });\n    }\n\n    onSketchpadClear(event: SketchpadEvent) {\n        this.sketchpad.clear();\n        G.ws.emit(\"draw\", {\n            type: \"clear\",\n        });\n    }\n\n\n    addListeners() {\n        // G.ws.on(\"message\", this.onWsMessage, this);\n        // G.ws.on(\"room\", this.onWsRoomInfo, this);\n        G.ws.on(\"draw\", this.onWsDraw, this);\n        // G.ws.on(\"ready\", this.onWsReady, this);\n        G.ws.on(\"startMe\", this.onWsStartMe, this);\n        G.ws.on(\"startOther\", this.onWsStartOther, this);\n        G.ws.on(\"answer\", this.onWsAnswer, this);\n        G.ws.on(\"result\", this.onWsResult, this);\n        G.ws.on(\"over\", this.onWsOver, this);\n        // G.ws.on(\"hint\", this.onWsHint, this);\n        // G.ws.on(\"tick\", this.onWsTicker, this);\n        // G.ws.on(\"score\", this.onWsScore, this);\n        G.ws.on(\"exit\", this.onWsExit, this);\n        G.on(SketchpadEvent.COLOR, this.onSketchpadColor, this);\n        G.on(SketchpadEvent.WIDTH, this.onSketchpadWidth, this);\n        G.on(SketchpadEvent.CLEAR, this.onSketchpadClear, this);\n        this.intervalId = setInterval(() => {\n            this.syncPath();\n        }, 200);\n    }\n\n    removeListeners() {\n        clearInterval(this.intervalId);\n        G.ws.offTarget(this);\n        G.targetOff(this);\n    }\n\n    onDestroy() {\n        this.removeListeners();\n    }\n\n}\n"]}